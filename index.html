<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á ‡∏™.‡∏™. ‡πÄ‡∏Ç‡∏ï 4 ‡∏Å‡∏ó‡∏°.(5/18 ‡∏™‡∏™.)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.bootstrap5.min.css">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; }
        .card-stat { border: none; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); color: white; margin-bottom: 20px;}
        .bg-turnout { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bg-good { background: linear-gradient(135deg, #2af598 0%, #009efd 100%); }
        .bg-bad { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); color: #444; }
        .bg-no { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); color: #444; }
        
        #stationTable th { text-align: center; vertical-align: middle; white-space: nowrap; font-size: 0.9rem; }
        #stationTable td { text-align: right; vertical-align: middle; font-size: 0.9rem; }
        #stationTable td:first-child { text-align: left; font-weight: bold; min-width: 120px; }
        
        .winner-cell { background-color: #d1e7dd !important; color: #0f5132; font-weight: bold; border: 2px solid #198754 !important; }
        .candidate-bar-container { height: 8px; background-color: #e9ecef; border-radius: 4px; width: 100%; margin-top: 5px; }
        .candidate-bar { height: 100%; border-radius: 4px; }
        #loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:9999; display:flex; align-items:center; justify-content:center; }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="text-center">
        <div class="spinner-border text-primary" role="status"></div>
        <div class="mt-2 fw-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏î‡∏à‡∏≤‡∏Å Google Sheets...</div>
    </div>
</div>

<div class="container-fluid py-4 px-4">
    <div class="text-center mb-4">
        <h2 class="text-primary fw-bold">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á ‡∏™.‡∏™. ‡πÄ‡∏Ç‡∏ï 4 ‡∏Å‡∏ó‡∏°. (‡∏£‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢)</h2>
        <h5 class="text-secondary">‡πÅ‡∏Ç‡∏ß‡∏á‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢, ‡πÅ‡∏Ç‡∏ß‡∏á‡∏Ñ‡∏•‡∏≠‡∏á‡∏ï‡∏±‡∏ô, ‡πÅ‡∏Ç‡∏ß‡∏á‡∏û‡∏£‡∏∞‡πÇ‡∏Ç‡∏ô‡∏á</h5>
        <p class="small text-muted">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å Google Sheets</p>
    </div>

    <div class="row g-3">
        <div class="col-lg-3 col-6"><div class="card card-stat bg-turnout p-3"><h6>‡∏ú‡∏π‡πâ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥</h6><h3 id="sum-turnout">0</h3><small id="sum-turnout-pct">‡∏à‡∏≤‡∏Å ...</small></div></div>
        <div class="col-lg-3 col-6"><div class="card card-stat bg-good p-3"><h6>‡∏ö‡∏±‡∏ï‡∏£‡∏î‡∏µ</h6><h3 id="sum-good">0</h3><small id="sum-good-pct">...</small></div></div>
        <div class="col-lg-3 col-6"><div class="card card-stat bg-bad p-3"><h6>‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏™‡∏µ‡∏¢</h6><h3 id="sum-bad">0</h3><small id="sum-bad-pct">...</small></div></div>
        <div class="col-lg-3 col-6"><div class="card card-stat bg-no p-3"><h6>‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏î (Vote NO)</h6><h3 id="sum-no">0</h3><small id="sum-no-pct">...</small></div></div>
    </div>

    <div class="row mt-3">
        <div class="col-lg-4 mb-3">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white"><h5 class="m-0 text-primary">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</h5></div>
                <div class="card-body p-0" style="overflow-y: auto; max-height: 600px;">
                    <table class="table table-hover mb-0">
                        <thead class="table-light sticky-top">
                            <tr><th>#</th><th>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th><th class="text-end">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr>
                        </thead>
                        <tbody id="candidate-ranks"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="m-0 text-primary">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á (‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏° ‡∏™‡∏™. 5/18.)</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="stationTable" class="table table-bordered table-striped text-nowrap w-100">
                            <thead class="table-dark">
                                <tr>
                                    <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥</th><th>‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥</th><th>‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£</th><th>‡πÉ‡∏ä‡πâ‡πÑ‡∏õ</th>
                                    <th>‡∏î‡∏µ</th><th>‡πÄ‡∏™‡∏µ‡∏¢</th><th>No</th><th>‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                    <th>#1</th><th>#2</th><th>#3</th><th>#4</th><th>#5</th><th>#6</th><th>#7</th>
                                    <th>#8</th><th>#9</th><th>#10</th><th>#11</th><th>#12</th><th>#13</th>
                                </tr>
                            </thead>
                            <tbody id="station-rows"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

<script>
    const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbyaWeBghaKOdgiywzqIOaItEdXmFW4bsZ-tphF0Jc9DP2KWZWM6aVa0fLvN04ORdrRMOQ/exec"; 

    // Hardcoded Candidate Meta
    const candidates = [
        {no: 1, name: "‡∏ô‡∏≤‡∏¢‡∏û‡∏á‡∏®‡∏Å‡∏£ ‡∏Ç‡∏ß‡∏±‡∏ç‡πÄ‡∏°‡∏∑‡∏≠‡∏á (‡πÄ‡∏ö‡∏≠‡∏£‡πå 1)", party: "‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ò‡∏¥‡∏õ‡∏±‡∏ï‡∏¢‡πå", color: "#0d6efd"},
        {no: 2, name: "‡∏ô‡∏≤‡∏¢‡∏†‡∏±‡∏ì‡∏ë‡∏¥‡∏• ‡∏ô‡πà‡∏ß‡∏°‡πÄ‡∏à‡∏¥‡∏° (‡πÄ‡∏ö‡∏≠‡∏£‡πå 2)", party: "‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô", color: "#dc6f35"},
        {no: 3, name: "‡∏ô‡∏≤‡∏¢‡∏ä‡∏¢‡∏û‡∏á‡∏®‡πå ‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤ (‡πÄ‡∏ö‡∏≠‡∏£‡πå 3)", party: "‡πÑ‡∏ó‡∏¢‡∏Å‡πâ‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà", color: "#6c757d"},
        {no: 4, name: "‡∏ô.‡∏™.‡∏ö‡∏∏‡∏ì‡∏¢‡∏Å‡∏£ ‡∏î‡∏≥‡∏£‡∏á‡∏£‡∏±‡∏ï‡∏ô‡πå (‡πÄ‡∏ö‡∏≠‡∏£‡πå 4)", party: "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏ó‡∏¢", color: "#dc3545"},
        {no: 5, name: "‡∏ô‡∏≤‡∏¢‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÑ‡∏Å‡∏£ ‡∏•‡∏µ‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏í‡∏ô‡∏∞ (‡πÄ‡∏ö‡∏≠‡∏£‡πå 5)", party: "‡∏û‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏£‡∏±‡∏ê", color: "#0d6efd"},
        {no: 6, name: "‡∏ô‡∏≤‡∏¢‡πÄ‡∏Ç‡∏ï‡∏£‡∏±‡∏ê ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏ó‡∏±‡∏®‡∏ô‡πå (‡πÄ‡∏ö‡∏≠‡∏£‡πå 6)", party: "‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à‡πÑ‡∏ó‡∏¢", color: "#00008b"},
        {no: 7, name: "‡∏ô‡∏≤‡∏¢‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏±‡∏ó‡∏ò‡πå ‡πÇ‡∏®‡∏†‡∏ß‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏¥‡∏£‡∏¥ (‡πÄ‡∏ö‡∏≠‡∏£‡πå 7)", party: "‡∏õ‡∏ß‡∏á‡∏ä‡∏ô‡πÑ‡∏ó‡∏¢", color: "#6c757d"},
        {no: 8, name: "‡∏ô‡∏≤‡∏¢‡∏£‡∏∏‡∏à‡∏¥‡∏£‡∏∞ ‡∏≠‡∏±‡∏Ñ‡∏£‡∏≤‡∏û‡∏¥‡∏£‡∏¥‡∏¢‡∏û‡∏á‡∏®‡πå (‡πÄ‡∏ö‡∏≠‡∏£‡πå 8)", party: "‡πÑ‡∏ó‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ó‡∏¢", color: "#0d6efd"},
        {no: 9, name: "‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏¢‡∏ï‡∏£‡∏µ‡∏´‡∏ç‡∏¥‡∏á ‡∏õ‡∏†‡∏±‡∏™‡∏£‡∏≤‡∏ß‡∏£‡∏£‡∏ì (‡πÄ‡∏ö‡∏≠‡∏£‡πå 9)", party: "‡∏Å‡∏•‡πâ‡∏≤‡∏ò‡∏£‡∏£‡∏°", color: "#6c757d"},
        {no: 10, name: "‡∏ô‡∏≤‡∏¢‡∏ö‡∏∏‡∏ç‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥ ‡∏ß‡∏¥‡∏®‡∏≤‡∏•‡πÇ‡∏Å‡∏®‡∏• (‡πÄ‡∏ö‡∏≠‡∏£‡πå 10)", party: "‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à", color: "#6c757d"},
        {no: 11, name: "‡∏ô‡∏≤‡∏¢‡∏™‡∏£‡∏¢‡∏∏‡∏ó‡∏ò ‡∏•‡∏¥‡∏Ç‡∏¥‡∏ï‡∏≠‡∏≤‡∏†‡∏≤‡∏Å‡∏∏‡∏• (‡πÄ‡∏ö‡∏≠‡∏£‡πå 11)", party: "‡∏£‡∏±‡∏Å‡∏ä‡∏≤‡∏ï‡∏¥", color: "#6c757d"},
        {no: 12, name: "‡∏ô‡∏≤‡∏¢‡∏™‡∏Å‡∏•‡∏†‡∏±‡∏ó‡∏£ ‡∏õ‡∏£‡∏∞‡∏¢‡∏π‡∏£‡∏£‡∏±‡∏ï‡∏ô‡πå (‡πÄ‡∏ö‡∏≠‡∏£‡πå 12)", party: "‡∏£‡∏ß‡∏°‡πÑ‡∏ó‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏≤‡∏ï‡∏¥", color: "#0d6efd"},
        {no: 13, name: "‡∏ô.‡∏™.‡∏û‡∏£‡∏û‡∏¥‡∏°‡∏• ‡∏â‡∏¥‡∏°‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡πå (‡πÄ‡∏ö‡∏≠‡∏£‡πå 13)", party: "‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏´‡∏°‡πà", color: "#6c757d"}
    ];

    $(document).ready(function() {
        fetch(SHEET_API_URL)
            .then(res => res.json())
            .then(data => {
                renderElection(data);
                $('#loading-overlay').fadeOut();
            })
            .catch(err => alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"));
    });

    function renderElection(sheetData) {
        let tEligible = 0, tTurnout = 0, tGood = 0, tBad = 0, tNo = 0;
        let candidateScores = Array(13).fill(0);
        const body = $('#station-rows');
        

        const numStations = sheetData[0].length; 


        for (let j = 0; j < numStations; j++) {

            const st = {
                name:     sheetData[0][j],  // D1
                eligible: parseInt(sheetData[1][j]) || 0, // D2
                turnout:  parseInt(sheetData[2][j]) || 0, // D3
                allotted: parseInt(sheetData[3][j]) || 0, // D4
                used:     parseInt(sheetData[4][j]) || 0, // D5
                good:     parseInt(sheetData[5][j]) || 0, // D6
                bad:      parseInt(sheetData[6][j]) || 0, // D7
                noVote:   parseInt(sheetData[7][j]) || 0, // D8
                remain:   parseInt(sheetData[8][j]) || 0, // D9
                scores:   [] // D10 - D22
            };

            for (let i = 9; i <= 21; i++) {
                let score = parseInt(sheetData[i][j]) || 0;
                st.scores.push(score);
                candidateScores[i-9] += score;
            }

            tEligible += st.eligible; tTurnout += st.turnout; tGood += st.good; tBad += st.bad; tNo += st.noVote;

            const maxVal = Math.max(...st.scores);
            let row = `<tr><td class="fw-bold">${st.name}</td><td>${st.eligible}</td><td>${st.turnout}</td><td>${st.allotted}</td><td>${st.used}</td><td>${st.good}</td><td class="text-danger">${st.bad}</td><td>${st.noVote}</td><td>${st.remain}</td>`;
            st.scores.forEach(s => { row += `<td class="${(s === maxVal && s > 0) ? 'winner-cell' : ''}">${s}</td>`; });
            body.append(row + `</tr>`);
        }

        // Summary Cards
        $('#sum-turnout').text(tTurnout.toLocaleString());
        $('#sum-turnout-pct').text(`‡∏à‡∏≤‡∏Å ${tEligible.toLocaleString()} (${((tTurnout/tEligible)*100).toFixed(2)}%)`);
        $('#sum-good').text(tGood.toLocaleString());
        $('#sum-bad').text(tBad.toLocaleString());
        $('#sum-no').text(tNo.toLocaleString());

        // Ranking Table
        const ranked = candidates.map((c, i) => ({...c, score: candidateScores[i]})).sort((a,b) => b.score - a.score);
        const maxScore = ranked[0].score;
        ranked.forEach((c, i) => {
            $('#candidate-ranks').append(`
                <tr>
                    <td class="text-center fw-bold">${i+1}</td>
                    <td>
                        <div class="fw-bold">${c.name}</div>
                        <small class="text-muted">${c.party}</small>
                        <div class="candidate-bar-container"><div class="candidate-bar" style="width:${(c.score/maxScore)*100}%; background:${c.color}"></div></div>
                    </td>
                    <td class="text-end fw-bold">${c.score.toLocaleString()}</td>
                </tr>
            `);
        });

        $('#stationTable').DataTable({ "scrollX": true, "pageLength": 10 });
    }
</script>
</body>
</html>
